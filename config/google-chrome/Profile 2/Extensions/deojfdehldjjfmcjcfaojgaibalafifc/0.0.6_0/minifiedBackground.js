let tabDetails;const domain_ip_addresses=["142.250.193.147","34.233.30.196","35.212.92.221"];let currentKey=null,reloadTabOnNextUrlChange=!1;const urlPatterns=["mycourses/details?id=","test?id=","mycdetails?c_id=","/test-compatibility"];let isReloading=!1;function fetchExtensionDetails(e){chrome.management.getAll((t=>{const a=t.filter((e=>e.enabled&&"NeoExamShield"!==e.name&&"extension"===e.type)).length;e(t,a)}))}const fetchDomainIp=e=>new Promise((t=>{const a=new URL(e).hostname;fetch(`https://dns.google/resolve?name=${a}`).then((e=>e.json())).then((e=>{const a=e.Answer.find((e=>1===e.type))?.data||null;t(a)})).catch((()=>{t(null)}))}));async function handleUrlChange(){if(urlPatterns.some((e=>tabDetails.url.includes(e)))){let e=await fetchDomainIp(tabDetails.url);e&&domain_ip_addresses.includes(e)||tabDetails.url.includes("examly.net")||tabDetails.url.includes("examly.test")?fetchExtensionDetails(((e,t)=>{let a={action:"getUrlAndExtensionData",url:tabDetails.url,enabledExtensionCount:t,extensions:e,id:tabDetails.id,currentKey:currentKey};chrome.tabs.sendMessage(tabDetails.id,a,(e=>{chrome.runtime.lastError&&"Could not establish connection. Receiving end does not exist."===chrome.runtime.lastError.message&&chrome.tabs.update(tabDetails.id,{url:tabDetails.url})}))})):console.log("Failed to fetch IP address")}}function openNewMinimizedWindowWithUrl(e){chrome.tabs.create({url:e},(e=>{}))}function reloadMatchingTabs(){isReloading||(isReloading=!0,chrome.tabs.query({},(e=>{e.forEach((e=>{urlPatterns.some((t=>e.url.includes(t)))&&chrome.tabs.reload(e.id,(()=>{console.log(`Reloaded tab ${e.id} with URL: ${e.url}`)}))})),setTimeout((()=>{isReloading=!1}),1e3)})))}chrome.runtime.onInstalled.addListener((()=>{chrome.tabs.query({active:!0,currentWindow:!0},(e=>{chrome.tabs.update(e[0].id,{url:e[0].url})}))})),chrome.tabs.onActivated.addListener((e=>{chrome.tabs.get(e.tabId,(e=>{tabDetails=e,handleUrlChange()}))})),chrome.tabs.onUpdated.addListener(((e,t,a)=>{"complete"===t.status&&(tabDetails=a,handleUrlChange())})),chrome.windows.onFocusChanged.addListener((e=>{e!==chrome.windows.WINDOW_ID_NONE&&chrome.tabs.query({active:!0,windowId:e},(e=>{e.length>0&&(tabDetails=e[0],handleUrlChange())}))})),chrome.management.onEnabled.addListener((e=>{reloadMatchingTabs()})),chrome.management.onDisabled.addListener((e=>{reloadMatchingTabs()})),chrome.runtime.onMessage.addListener(((e,t,a)=>{currentKey=e.key,"pageReloaded"===e.action||"windowFocus"===e.action?handleUrlChange():"openNewTab"===e.action&&openNewMinimizedWindowWithUrl(e.url)}));